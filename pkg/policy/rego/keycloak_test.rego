package keycloak

sample_token := "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJyOWtrNl9lMlJBTDdmY2xnYjdfZmdkTklqQ0RSelh1Z1R3ZFliU1lPXy00In0.eyJleHAiOjE2NTUzODc4MjEsImlhdCI6MTY1NTM4NzUyMSwiYXV0aF90aW1lIjoxNjU1Mzg3NTIxLCJqdGkiOiJkNDJkMDkyNC1kZGViLTRlOTUtODNiOS00YWYxYzMyOGIwMDEiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0Ojg4ODgvcmVhbG1zL3NtYXJ0LWNvcmUiLCJhdWQiOiJzYy1hcGkiLCJzdWIiOiJkZTFhZTE2MC0yNTA5LTRmMjgtYmQ0ZS1jNDdkMzBjNzZhNmQiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJzYy1hcHBzIiwibm9uY2UiOiIwNTI1ZTY3MS0wMjE2LTQzZGUtOGI3My0yOTE2YWRlODk2OTEiLCJzZXNzaW9uX3N0YXRlIjoiZTMzYTAyMjItZGYwZS00ZGViLThkMjktOTkxZjBlYjI4MjU0IiwicmVzb3VyY2VfYWNjZXNzIjp7InNjLWFwaSI6eyJyb2xlcyI6WyJUZXN0LkFkbWluIiwiVGVzdC5Vc2VyIl19fSwic2NvcGUiOiJvcGVuaWQgZW1haWwgVGVzdC5Xcml0ZSBUZXN0LlJlYWQiLCJzaWQiOiJlMzNhMDIyMi1kZjBlLTRkZWItOGQyOS05OTFmMGViMjgyNTQiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsImVtYWlsIjoibWF0dC5yYW5kZWxsQHZhbnRpLmNvLnVrIn0.VX0Xhv3869cun9V4yHW-WliPbjMKgXeekcDvJEyNsjSvK7Md8X2epm2c2TMct1DXBszDVbrt9exfw3TNLmNx5bRsxI3ZvnZnyzF0SJopihIZeERW6FV4Vw5thFAR6-6c2tB94m-yBYUdIdeu9sdyOZFZEU3QOQ1My96nDVi9c8_huHC-Zx-2VZh6OPgbsWRuKYtbGWSqWdGEhqmGRCyFdyhvBmiyBujGoPn6ammHJr-Y6V8ljKmsstlQ_CpCKJM10zJcy9xll6RrtEp9EfQE0DtVHjWIin4J_1FC4Rf4wOkRnJ46nsIUqgLqxvV9x9F1hC3soA9SfDe78fGN1-1dqA"
sample_jwks := {"keys":[{"kid":"r9kk6_e2RAL7fclgb7_fgdNIjCDRzXugTwdYbSYO_-4","kty":"RSA","alg":"RS256","use":"sig","n":"ugHoDebh-t_YnrHvvHVKn2cKy1AtPG9an1P-X-ivrKA4CtbBB0WtuA8wKrc2dJLQSdHvBrEMLGaNJpB9-F2u5ACTHzopX_TZSerQBytmANNcJ3pnxOSgWz5rOvTZmYA-Xqehh-vXwuE9AN0Ze4fogSFSSDqO4QC2o4w9BUq09tVgWtetyNy1d-ngRWTlEvZ1cyNcbEZq2tobIHG5nhFkP7KO-LNCWeYYHlHAPli8fi58IRS9fyoW0KJ-4eZCdtMt1dhiq0fL5ju8Dd_ZPW379OCEnXw4M2g4f-VI6XqAxS4kXFoAOueqI4r9I-inhZ3tBTapFGYkrk_Kq11zJ0_FDQ","e":"AQAB","x5c":["MIICozCCAYsCBgGBSAETBzANBgkqhkiG9w0BAQsFADAVMRMwEQYDVQQDDApzbWFydC1jb3JlMB4XDTIyMDYwOTEwMjUzOFoXDTMyMDYwOTEwMjcxOFowFTETMBEGA1UEAwwKc21hcnQtY29yZTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALoB6A3m4frf2J6x77x1Sp9nCstQLTxvWp9T/l/or6ygOArWwQdFrbgPMCq3NnSS0EnR7waxDCxmjSaQffhdruQAkx86KV/02Unq0AcrZgDTXCd6Z8TkoFs+azr02ZmAPl6noYfr18LhPQDdGXuH6IEhUkg6juEAtqOMPQVKtPbVYFrXrcjctXfp4EVk5RL2dXMjXGxGatraGyBxuZ4RZD+yjvizQlnmGB5RwD5YvH4ufCEUvX8qFtCifuHmQnbTLdXYYqtHy+Y7vA3f2T1t+/TghJ18ODNoOH/lSOl6gMUuJFxaADrnqiOK/SPop4Wd7QU2qRRmJK5PyqtdcydPxQ0CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEArGEzeRFlfZWddEaiWFZN+hVIWv0ld0Jylolb/0qDONjsQsxi+rUJ8YaZEyCwNDqpt33JSVSZsVi5Yvy1UMo6fbYx22x+0nDIlaP9BmKwAlbENIULrg/qHZKHgvW8P29WNGvfivuyBYU2c5GkQj1pKTQrWu+kdkV+u1veEwRavG7BoGKbLCnWZST92OJS4H9qR6uo7s/EHIj4U8tMm6PvglE0JHb6UhGepaBRl+7rl1/WcEYmQalbTi0Tapf2/4G4aiyIUhYf8lK5i7RGEsNQ2xI5yR3nuOdlu/+VijSRXathksclBNUYk5JC9HwJMriV8Rti85F9ox35xpNpVDdEgQ=="],"x5t":"2gCrL0FA-dfIFImsaVv309lGDgo","x5t#S256":"0CaLL1JYtge_g03P5A1qGIXFHWxSyejfwO_rjsCanYg"},{"kid":"IA9Ce6ExfmlHTRVkufStXVXeJtRVzOypedFC60Y_cJQ","kty":"RSA","alg":"RSA-OAEP","use":"enc","n":"iaxq9lOmArrTN6p23lzTWMCwMuQ7OnNWOQACcprPXHlnkCj8p-P1xdGvUWOQbC6zuAnHcKo-7v3GMOLAFQmU4xbHnTgPo6mTs8S403uvYPkGig_Sh2X99aW3xSg6mLoxtOPbnGrUzZIqstG64eI4BixQ3kyvOfQKKUHdEfN6uge7Gr2KS0D_InXwLiI8HZsTUxT_n43GqXDZnzxoJpxe8w48171eNMuZvzPvTy59pTTKi7ynN2TQsQqn9SHJDS9QRTYVPyC6XSQG9IsHoAtJqqEQ16qI6RLrmHgNj7UvHYf12EMnfnYCTdF626LB1xQNtORp32xxuA8jiU7Z2S2D3w","e":"AQAB","x5c":["MIICozCCAYsCBgGBSAET4zANBgkqhkiG9w0BAQsFADAVMRMwEQYDVQQDDApzbWFydC1jb3JlMB4XDTIyMDYwOTEwMjUzOVoXDTMyMDYwOTEwMjcxOVowFTETMBEGA1UEAwwKc21hcnQtY29yZTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAImsavZTpgK60zeqdt5c01jAsDLkOzpzVjkAAnKaz1x5Z5Ao/Kfj9cXRr1FjkGwus7gJx3CqPu79xjDiwBUJlOMWx504D6Opk7PEuNN7r2D5BooP0odl/fWlt8UoOpi6MbTj25xq1M2SKrLRuuHiOAYsUN5Mrzn0CilB3RHzeroHuxq9iktA/yJ18C4iPB2bE1MU/5+Nxqlw2Z88aCacXvMOPNe9XjTLmb8z708ufaU0you8pzdk0LEKp/UhyQ0vUEU2FT8gul0kBvSLB6ALSaqhENeqiOkS65h4DY+1Lx2H9dhDJ352Ak3RetuiwdcUDbTkad9scbgPI4lO2dktg98CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEARZmI9VCdMcwb15DhKLYViSO17Lqcj/AxgmxtgwIANcJ1co0n0SSCqIg3/VnwQQDdSU1bXmBQ3i5BryfQviESrWSIFuCfSha3Bxh2EvPcLT50bFHgLDNaBFD5SOC+YA5/SHNX01WtvogHmrXzsqKeWHaYkuneV2zBQheWfI8c8GqOd6uEt4uObqgpyecU6n87EkilB5btoxhkgSXWQV2k0pLKe/PRfJdNyN6S4zVEJmdD0OS9JDZVqVebCmx4uCbtfQbSyqaACQ/YLqKORkG+ndfW/+Rk4X3DDDkJBofcHEZqkQ+q6qmeyMy7TUC971ES4m0vjdRTkxVkUw0iIMogBg=="],"x5t":"bfcN4F9Gu8IwbNAy-u9qY7PASPQ","x5t#S256":"5ippKrBr4Q5WWSSCI_wtv5aWX4_5R9VijXRzuJlWIbQ"}]}
sample_time := time.parse_rfc3339_ns("2022-06-16T13:55:23+00:00")

test_kid {
  hdr := jwt_header with input.access_token as sample_token
  hdr.kid == "r9kk6_e2RAL7fclgb7_fgdNIjCDRzXugTwdYbSYO_-4"
}

test_verify_signature {
  io.jwt.verify_rs256(sample_token, json.marshal(sample_jwks))
}

test_verify_claims {
  [_, claims, _] := io.jwt.decode(sample_token)

  claims.aud == "sc-api"
  claims.iss == issuer
}